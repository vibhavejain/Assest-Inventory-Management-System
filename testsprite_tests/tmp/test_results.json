[
  {
    "projectId": "3fe4a4ae-8009-4f9a-832d-b6370c49f4a8",
    "testId": "816113b4-67a6-4ab3-8357-a45d93cc82c2",
    "userId": "b418b4e8-d061-7000-e118-2a80ac129881",
    "title": "TC009-company access api manage user access to company",
    "description": "Verify GET /companies/{companyId}/users lists users with access or 404 if company not found; POST /companies/{companyId}/users grants access with valid data returning 201 or 400 for validation errors; DELETE /companies/{companyId}/users/{userId} revokes access returning 200 or 404 if access not found.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8787\"\nTIMEOUT = 30\nHEADERS = {\"Content-Type\": \"application/json\"}\n\n\ndef test_company_access_api_manage_user_access_to_company():\n    # Helper function to create a company\n    def create_company():\n        url = f\"{BASE_URL}/companies\"\n        payload = {\"name\": \"Test Company for Access API\"}\n        resp = requests.post(url, json=payload, timeout=TIMEOUT, headers=HEADERS)\n        assert resp.status_code == 201\n        data = resp.json()\n        company_id = data.get('id')\n        assert company_id is not None\n        return company_id\n\n    # Helper function to delete a company\n    def delete_company(company_id):\n        url = f\"{BASE_URL}/companies/{company_id}\"\n        resp = requests.delete(url, timeout=TIMEOUT)\n        # As per PRD, delete company returns 200 or 404\n        assert resp.status_code in (200, 404)\n\n    # Helper function to create a user\n    def create_user():\n        url = f\"{BASE_URL}/users\"\n        # Use a unique email to avoid duplicate conflicts\n        import uuid\n        unique_email = f\"testuser-{uuid.uuid4()}@example.com\"\n        payload = {\"email\": unique_email, \"name\": \"Test User\"}\n        resp = requests.post(url, json=payload, timeout=TIMEOUT, headers=HEADERS)\n        assert resp.status_code == 201\n        data = resp.json()\n        user_id = data.get('id')\n        assert user_id is not None\n        return user_id\n\n    # Helper function to delete a user\n    def delete_user(user_id):\n        url = f\"{BASE_URL}/users/{user_id}\"\n        resp = requests.delete(url, timeout=TIMEOUT)\n        # User delete returns 200 or 404\n        assert resp.status_code in (200, 404)\n\n    # Create company and user for testing\n    company_id = create_company()\n    user_id = create_user()\n\n    try:\n        # 1. Verify GET /companies/{companyId}/users lists users with access or 404 if company not found\n        url_get_users = f\"{BASE_URL}/companies/{company_id}/users\"\n        resp_get_users = requests.get(url_get_users, timeout=TIMEOUT, headers=HEADERS)\n        assert resp_get_users.status_code == 200\n        data_get_users = resp_get_users.json()\n        assert \"data\" in data_get_users\n\n        # Also test GET with non-existent companyId (random uuid)\n        import uuid\n        fake_company_id = str(uuid.uuid4())\n        url_get_fake = f\"{BASE_URL}/companies/{fake_company_id}/users\"\n        resp_get_fake = requests.get(url_get_fake, timeout=TIMEOUT, headers=HEADERS)\n        assert resp_get_fake.status_code == 404\n\n        # 2. Verify POST /companies/{companyId}/users grants access with valid data returning 201 or 400 for validation errors\n        url_post_access = f\"{BASE_URL}/companies/{company_id}/users\"\n        payload_valid = {\"user_id\": user_id, \"role\": \"admin\"}\n        resp_post = requests.post(url_post_access, json=payload_valid, timeout=TIMEOUT, headers=HEADERS)\n        assert resp_post.status_code == 201\n        data_post = resp_post.json()\n        # According to instructions, extract id but POST returns no user-company ID, only 201\n        # entity_id may or may not be returned depending on API - no confirmation in PRD so skip assert on id\n\n        # Test POST with invalid data (missing role)\n        payload_invalid = {\"user_id\": user_id}\n        resp_post_invalid = requests.post(url_post_access, json=payload_invalid, timeout=TIMEOUT, headers=HEADERS)\n        assert resp_post_invalid.status_code == 400\n\n        # 3. Verify DELETE /companies/{companyId}/users/{userId} revokes access returning 200 or 404 if access not found\n        url_delete_access = f\"{BASE_URL}/companies/{company_id}/users/{user_id}\"\n        resp_delete = requests.delete(url_delete_access, timeout=TIMEOUT)\n        assert resp_delete.status_code == 200\n\n        # Deleting again should return 404 because access not found\n        resp_delete_again = requests.delete(url_delete_access, timeout=TIMEOUT)\n        assert resp_delete_again.status_code == 404\n\n    finally:\n        # Cleanup: revoke access if exists (ignore errors)\n        try:\n            requests.delete(f\"{BASE_URL}/companies/{company_id}/users/{user_id}\", timeout=TIMEOUT)\n        except Exception:\n            pass\n        # Delete user and company\n        delete_user(user_id)\n        delete_company(company_id)\n\n\ntest_company_access_api_manage_user_access_to_company()",
    "testStatus": "FAILED",
    "testError": "Test execution timed out after 15 minutes",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-06T12:01:09.056Z",
    "modified": "2026-01-06T12:03:49.669Z"
  }
]
